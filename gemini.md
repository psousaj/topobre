# Gemini Project Configuration

This file helps Gemini understand your project's context, conventions, and commands.

## Project Overview

This project is a monorepo for a financial application called "topobre". It consists of several services, including a web frontend, an API, a background worker, and various other packages. The project is built with TypeScript and uses pnpm for package management and Turbo for monorepo orchestration.

## Key Technologies

- **Language:** TypeScript
- **Frameworks:** Next.js (in `apps/web`)
- **Package Manager:** pnpm (using workspaces)
- **Monorepo Manager:** Turbo
- **Containerization:** Docker
- **Linting/Formatting:** ESLint, Prettier
- **Observability:** Grafana, Loki, Prometheus, Tempo, Jaeger, OpenTelemetry

## Project Structure

This is a monorepo with the following structure:

- `apps/`: Contains the different applications of the project.
    - `api/`: The main API.
    - `web/`: The web frontend, built with Next.js.
    - `worker/`: A background worker for processing jobs.
    - `analytics/`, `billing/`, `budget-engine/`, `finloader/`, `notification/`, `reports/`: Other services and modules.
- `packages/`: Contains shared libraries and packages used across the applications.
    - `bullmq/`: Shared BullMQ configuration.
    - `env/`: Shared environment variable management.
    - `gemini/`: Gemini AI integration.
    - `ngrok/`: Ngrok integration for exposing local services.
    - `resend/`: Resend integration for sending emails.
    - `telemetry/`: Shared OpenTelemetry configuration.
    - `typeorm/`: Shared TypeORM configuration.
    - `winston/`: Shared Winston logger configuration.
- `config/`: Contains shared configuration files for tools like ESLint and TypeScript.
- `server/`: Contains infrastructure-as-code configurations (e.g., Docker Compose for services like Grafana, Loki, etc.).
- `build/`: Contains build-related scripts and configurations.
- `docs/`: Contains project documentation.

## Common Commands

Here are some of the most common commands for this project:

- `pnpm dev`: Starts all applications in development mode.
- `pnpm build`: Builds all applications.
- `pnpm lint`: Lints all applications.
- `pnpm dev:api`: Starts the API in development mode.
- `pnpm dev:worker`: Starts the worker in development mode.
- `pnpm dev:backend`: Starts both the API and the worker in development mode.
- `pnpm start:api`: Starts the API in production mode.
- `pnpm start:worker`: Starts the worker in production mode.
- `pnpm ngrok`: Exposes a local service to the internet using ngrok.
- `pnpm clean:build`: Cleans up build artifacts.

## Build Process

The project uses a two-step build process for most packages, orchestrated by Turbo.

1.  **`pnpm build:tsc`**: This command runs `tsc` (the TypeScript compiler) in each package. This step is responsible for type checking and generating JavaScript files and type definitions (`.d.ts` files) from the TypeScript source code. The output is typically placed in a `dist` directory within each package.

2.  **`pnpm build:tsup`**: This command runs `tsup`, a tool that bundles the JavaScript code generated by `tsc` into an optimized format. This is often used for creating smaller bundles for production use. This step usually depends on the output of the `build:tsc` step.

3.  **`pnpm build`**: This is the main build command. It uses `turbo` to run the `build` script in each package in the correct order, respecting the dependencies between them.

4.  **`pnpm build:all`**: This command is a convenience script that runs both `build:tsc` and `build:tsup` across the entire monorepo.

The `turbo.json` file defines the dependencies between these build tasks, ensuring that they are executed in the correct order.

## Docker

This project uses Docker for containerization.

- `docker-compose.infra.yml`: Defines the infrastructure services, such as databases, monitoring tools, etc.
- `docker-compose.apps.yml`: Defines the application services (api, worker, web).

To start the infrastructure services, run:

```bash
docker-compose -f docker-compose.infra.yml up -d
```

To start the application services, you first need to build the images and then run:

```bash
docker-compose -f docker-compose.apps.yml up -d
```

### Available Infrastructure Services

The following services are available when running the infrastructure with Docker Compose:

- **Grafana:** for visualization and monitoring.
- **Loki:** for log aggregation.
- **Prometheus:** for metrics and alerting.
- **Tempo:** for distributed tracing.
- **Jaeger:** for distributed tracing.
- **Otel-Collector:** for collecting and processing telemetry data.
- **Portainer:** for managing Docker containers.
- **Redis:** as a message broker and cache.